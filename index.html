<!DOCTYPE html>
<html>
<head>
    <title>LIFF Form</title>
    <script src="https://static.line-scdn.net/liff/2.1/sdk.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .form-container {
            margin-top: 20px;
        }
        .question {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .question label {
            margin-right: 10px;
        }
        .question select, .question input {
            padding: 8px;
            font-size: 14px;
        }
        .question input {
            width: 100%;
        }
    </style>
</head>
<body>
    <h2>กรอกข้อมูลบริษัท</h2>
    <div class="form-container" id="questionContainer">
        <!-- คำถามเริ่มต้น -->
        <div class="question">
            <select id="companyType">
                <option value="บจก.">บจก.</option>
                <option value="หจก.">หจก.</option>
            </select>
            <input type="text" id="companyName" placeholder="กรุณากรอกชื่อบริษัท" required>
        </div>
    </div>

    <button onclick="addQuestion()">เพิ่มคำถาม</button>
    <button onclick="submitForm()">ลงทะเบียน</button>

    <script>
        window.onload = function() {
            liff.init({ liffId: "2007078079-MzK8lPxY" }).then(() => {
                console.log("LIFF Initialized!");

                // ดึงข้อมูล Line ID และ Line Display Name ของผู้ใช้
                liff.getProfile().then(profile => {
                    window.lineId = profile.userId;  // เก็บ Line ID
                    window.displayName = profile.displayName;  // เก็บ Display Name
                }).catch(err => {
                    console.log("Error getting profile: ", err);
                });
            }).catch(err => {
                console.log("LIFF Initialization failed: ", err);
            });
        };

        // ฟังก์ชั่นเพิ่มคำถามใหม่
        function addQuestion() {
            const container = document.getElementById("questionContainer");

            const questionDiv = document.createElement("div");
            questionDiv.classList.add("question");

            const dropdown = document.createElement("select");
            dropdown.innerHTML = `
                <option value="บจก.">บจก.</option>
                <option value="หจก.">หจก.</option>
            `;

            const textbox = document.createElement("input");
            textbox.type = "text";
            textbox.placeholder = "กรุณากรอกข้อมูล";

            questionDiv.appendChild(dropdown);
            questionDiv.appendChild(textbox);
            container.appendChild(questionDiv);
        }

  // ฟังก์ชั่นสำหรับการส่งข้อมูลฟอร์ม
function submitForm() {
    const companyType = document.getElementById("companyType").value;
    const companyName = document.getElementById("companyName").value;

    // ตรวจสอบค่าที่ได้มาจากฟอร์ม
    console.log("companyType: ", companyType); // ตรวจสอบค่า dropdown
    console.log("companyName: ", companyName); // ตรวจสอบค่า textbox

    // ตรวจสอบให้แน่ใจว่าได้กรอกข้อมูลครบถ้วน
    if (!companyType || !companyName || !window.lineId) {
        alert("กรุณากรอกข้อมูลให้ครบถ้วน");
        return;  // หยุดการส่งข้อมูลหากมีข้อมูลไม่ครบ
    }

    const questions = document.querySelectorAll(".question");
    let formData = [];

    // รวบรวมข้อมูลจากคำถามทั้งหมด
    questions.forEach(q => {
        const dropdownValue = q.querySelector("select").value;
        const textValue = q.querySelector("input").value;

        // ตรวจสอบข้อมูลที่กรอกให้ครบถ้วน
        console.log("dropdownValue: ", dropdownValue); // ตรวจสอบค่าของ dropdown
        console.log("textValue: ", textValue); // ตรวจสอบค่าของ textbox

        if (!dropdownValue || !textValue) {
            alert("กรุณากรอกข้อมูลให้ครบทุกคำถาม");
            return;  // หยุดการส่งข้อมูลหากมีคำถามใดๆ ไม่ครบ
        }

        formData.push({ dropdown: dropdownValue, text: textValue });
    });

    // เพิ่มข้อมูลคำถามแรก (ประเภทบริษัทและชื่อบริษัท)
    formData.unshift({
        dropdown: companyType,
        text: companyName
    });

    // ส่งข้อมูล
    if (formData.length > 0 && window.lineId) {
        const payload = {
            data: formData,
            lineId: window.lineId,
            displayName: window.displayName
        };

        const scriptUrl = "https://script.google.com/macros/s/AKfycbw1Z7qIVNEOPbJCbzL7RB1bbzDCdL0ZM8F8be5dwPJ7g2SH322iWENttvC1L5sMJV1zGw/exec";

        fetch(scriptUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        })
        .then(response => response.json())
        .then(data => {
            alert("ส่งข้อมูลสำเร็จ!");
        })
        .catch(error => {
            alert("เกิดข้อผิดพลาดในการส่งข้อมูล: " + error);
        });
    }
}
    </script>
</body>
</html>
